apiVersion: v1
kind: Pod
metadata:
  name: "{{ .AppName }}--chat-bot-2"
  labels:
    ai-services.io/application: "{{ .AppName }}"
  annotations:
    ai-services.io/ui--UI_PORT2-expose: "3000" # containerPort
spec:
  containers:
    - name: ui
      image: icr.io/ai-services-private/rag-ui:v0.0.2
      resources:
        requests:
          memory: "1Gi"
        limits:
          memory: "5Gi"
      env:
        - name: BACKEND_HOST
          value: "{{ .AppName  }}--chat-bot-2"
        - name: BACKEND_PORT
          value: "5002" 
      ports:
        - name: UI_PORT2
          containerPort: 3000
          protocol: TCP
    - name: backend-server
      image: icr.io/ai-services-private/rag:v0.0.3
      command:
        - "/var/venv/bin/python"
        - "-m"
        - "retrieve.backend_server"
        - "5002"
      env:
        - name: EMB_ENDPOINT
          value: "http://{{ .AppName  }}--vllm-server:8001"
        - name: EMB_MODEL
          value: "ibm-granite/granite-embedding-278m-multilingual"
        - name: EMB_MAX_TOKENS
          value: "512"
        - name: LLM_ENDPOINT
          value: "http://{{ .AppName  }}--vllm-server:8000"
        - name: LLM_MODEL
          value: "ibm-granite/granite-3.3-8b-instruct"
        - name: RERANKER_ENDPOINT
          value: "http://{{ .AppName  }}--vllm-server:8002"
        - name: RERANKER_MODEL
          value: "BAAI/bge-reranker-v2-m3"
        - name: MILVUS_HOST
          value: "{{ .AppName  }}--milvus"
        - name: MILVUS_PORT
          value: "19530"
        - name: MILVUS_DB_PREFIX
          value: "RAG_DB"
        - name: MILVUS_COLLECTION_NAME
          value: "{{ .AppName  }}"
      resources:
        requests:
          memory: "1Gi"
        limits:
          memory: "5Gi"
      volumeMounts:
        - mountPath: /var/cache:Z
          name: cache
          readOnly: true
      ports:
        - containerPort: 5002
          hostPort: 5002
          protocol: TCP
  volumes:
    - name: cache
      hostPath:
        path: "/var/lib/ai-services/{{ .AppName }}/cache"
        type: DirectoryOrCreate